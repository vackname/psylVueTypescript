var debugPort=9788;var bundleDebugWsSocket=function(uri){this.uri=uri;this.obj=null};bundleDebugWsSocket.prototype.input=function(s){console.log(s)};bundleDebugWsSocket.prototype.connect=function(){var $t=this;var bundleDebugWsSocketFun=function(){$t.socket=new WebSocket($t.uri);$t.socket.onopen=function(e){if(e!=undefined){$t.input({webstatus:"connect",mes:"opened",obj:e})}};$t.socket.onclose=function(e){if(e!=undefined){$t.input({webstatus:"close",mes:"closed",obj:e})}};$t.socket.onmessage=function(e){if(e!=undefined){$t.input({webstatus:"received",mes:e.data,obj:e})}else{$t.input({webstatus:"messageLoss",mes:e.data,obj:e})}};$t.socket.onerror=function(e){if(e!=undefined){$t.input({webstatus:"error",mes:e.data,obj:e})}}};bundleDebugWsSocketFun()};bundleDebugWsSocket.prototype.sendMes=function(text){this.socket.send(text)};var runbundDebugHello=false;function bundDebugHello(){try{if(webSocketEventBundleDebug.webSocket!=null){webSocketEventBundleDebug.webSocket.sendMes("@SetHello")}}catch(e){}setTimeout(function(){bundDebugHello()},5e4)}var webSocketEventBundleDebug={webSocket:null,webHelloRun:false,LoginFlag:false,reConnectCount:10,Connect:function(mes){},Close:function(mes){setTimeout(function(){if(webSocketEventBundleDebug.reConnectCount>0){webSocketEventBundleDebug.webHelloRun=null;webSocketEventBundleDebug.LoginFlag=false;InitWebSocketBundleDebug(debugPort)}webSocketEventBundleDebug.reConnectCount--},2e3)},Received:function(mes){if(mes.indexOf("@init[")>-1){console.warn("bundle WebSocket ID->"+mes.substring(6));if(!runbundDebugHello){runbundDebugHello=true;bundDebugHello()}}else if(mes.indexOf("@GetBundleMessage[")>-1){var newVersion=mes.substring(18,29);var message=mes.substring(32);console.info(message);if(newVersion!="@@@@@@@@@@@"){console.warn("update code->"+newVersion);setTimeout(function(){document.location.href=location},300)}}},Error:function(mes){setTimeout(function(){if(webSocketEventBundleDebug.reConnectCount>0){webSocketEventBundleDebug.webHelloRun=null;webSocketEventBundleDebug.LoginFlag=false;InitWebSocketBundleDebug(debugPort)}webSocketEventBundleDebug.reConnectCount--},2e3)}};function InitWebSocketBundleDebug(port){console.log("webSocket 進入資訊--------(前端共構SDK)");debugPort=port;var webSocket=new bundleDebugWsSocket("ws://127.0.0.1:"+port+"/wsBundleDebugLog");webSocket.input=function(e){switch(e.webstatus){case"connect":webSocketEventBundleDebug.Connect(e.mes);break;case"close":webSocketEventBundleDebug.Close(e.obj.reason);break;case"received":webSocketEventBundleDebug.Received(e.mes);break;case"error":webSocketEventBundleDebug.Error(e.mes);break}};webSocketEventBundleDebug.webSocket=webSocket;webSocketEventBundleDebug.webSocket.connect()}